import{L as Ce,F as xe,G as ie,h as le,d as se,C as fe,c as ye,b as Ee,t as Ne,S as be,A as Fe,P as Me,k as Ae,W as Se,l as Te,V as Le,O as Be}from"./OrbitControls-PK4fmBsq.js";import{_ as Oe,y as Ue,o as je,c as Re,a as G,p as _e,l as ke}from"./index-2Mha699D.js";/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var ce=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};try{URL.revokeObjectURL(ce(""))}catch{ce=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)}}var b=Uint8Array,R=Uint16Array,X=Uint32Array,me=new b([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ue=new b([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ze=new b([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ve=function(e,t){for(var n=new R(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];for(var a=new X(n[30]),r=1;r<30;++r)for(var u=n[r];u<n[r+1];++u)a[u]=u-n[r]<<5|r;return[n,a]},de=ve(me,2),he=de[0],Ie=de[1];he[28]=258,Ie[258]=28;var De=ve(ue,0),Ve=De[0],Y=new R(32768);for(var p=0;p<32768;++p){var j=(p&43690)>>>1|(p&21845)<<1;j=(j&52428)>>>2|(j&13107)<<2,j=(j&61680)>>>4|(j&3855)<<4,Y[p]=((j&65280)>>>8|(j&255)<<8)>>>1}var H=function(e,t,n){for(var r=e.length,a=0,u=new R(t);a<r;++a)++u[e[a]-1];var d=new R(t);for(a=0;a<t;++a)d[a]=d[a-1]+u[a-1]<<1;var h;if(n){h=new R(1<<t);var o=15-t;for(a=0;a<r;++a)if(e[a])for(var c=a<<4|e[a],w=t-e[a],C=d[e[a]-1]++<<w,N=C|(1<<w)-1;C<=N;++C)h[Y[C]>>>o]=c}else for(h=new R(r),a=0;a<r;++a)e[a]&&(h[a]=Y[d[e[a]-1]++]>>>15-e[a]);return h},P=new b(288);for(var p=0;p<144;++p)P[p]=8;for(var p=144;p<256;++p)P[p]=9;for(var p=256;p<280;++p)P[p]=7;for(var p=280;p<288;++p)P[p]=8;var ge=new b(32);for(var p=0;p<32;++p)ge[p]=5;var He=H(P,9,1),Pe=H(ge,5,1),Z=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},A=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&n},J=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},Ge=function(e){return(e/8|0)+(e&7&&1)},ee=function(e,t,n){(t==null||t<0)&&(t=0),(n==null||n>e.length)&&(n=e.length);var r=new(e instanceof R?R:e instanceof X?X:b)(n-t);return r.set(e.subarray(t,n)),r},We=function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new b(0);var a=!t||n,u=!n||n.i;n||(n={}),t||(t=new b(r*3));var d=function(re){var ae=t.length;if(re>ae){var oe=new b(Math.max(ae*2,re));oe.set(t),t=oe}},h=n.f||0,o=n.p||0,c=n.b||0,w=n.l,C=n.d,N=n.m,M=n.n,F=r*8;do{if(!w){n.f=h=A(e,o,1);var _=A(e,o+1,3);if(o+=3,_)if(_==1)w=He,C=Pe,N=9,M=5;else if(_==2){var k=A(e,o,31)+257,m=A(e,o+10,15)+4,l=k+A(e,o+5,31)+1;o+=14;for(var f=new b(l),s=new b(19),i=0;i<m;++i)s[ze[i]]=A(e,o+i*3,7);o+=m*3;for(var v=Z(s),g=(1<<v)-1,E=H(s,v,1),i=0;i<l;){var I=E[A(e,o,g)];o+=I&15;var x=I>>>4;if(x<16)f[i++]=x;else{var y=0,T=0;for(x==16?(T=3+A(e,o,3),o+=2,y=f[i-1]):x==17?(T=3+A(e,o,7),o+=3):x==18&&(T=11+A(e,o,127),o+=7);T--;)f[i++]=y}}var D=f.subarray(0,k),U=f.subarray(k);N=Z(D),M=Z(U),w=H(D,N,1),C=H(U,M,1)}else throw"invalid block type";else{var x=Ge(o)+4,O=e[x-4]|e[x-3]<<8,B=x+O;if(B>r){if(u)throw"unexpected EOF";break}a&&d(c+O),t.set(e.subarray(x,B),c),n.b=c+=O,n.p=o=B*8;continue}if(o>F){if(u)throw"unexpected EOF";break}}a&&d(c+131072);for(var pe=(1<<N)-1,we=(1<<M)-1,W=o;;W=o){var y=w[J(e,o)&pe],z=y>>>4;if(o+=y&15,o>F){if(u)throw"unexpected EOF";break}if(!y)throw"invalid length/literal";if(z<256)t[c++]=z;else if(z==256){W=o,w=null;break}else{var te=z-254;if(z>264){var i=z-257,V=me[i];te=A(e,o,(1<<V)-1)+he[i],o+=V}var q=C[J(e,o)&we],K=q>>>4;if(!q)throw"invalid distance";o+=q&15;var U=Ve[K];if(K>3){var V=ue[K];U+=J(e,o)&(1<<V)-1,o+=V}if(o>F){if(u)throw"unexpected EOF";break}a&&d(c+131072);for(var ne=c+te;c<ne;c+=4)t[c]=t[c-U],t[c+1]=t[c+1-U],t[c+2]=t[c+2-U],t[c+3]=t[c+3-U];c=ne}}n.l=w,n.p=W,n.b=c,w&&(h=1,n.m=N,n.d=C,n.n=M)}while(!h);return c==t.length?t:ee(t,0,c)},qe=new b(0),L=function(e,t){return e[t]|e[t+1]<<8},S=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Q=function(e,t){return S(e,t)+S(e,t+4)*4294967296};function Ke(e,t){return We(e,t)}var $=typeof TextDecoder<"u"&&new TextDecoder,Ze=0;try{$.decode(qe,{stream:!0}),Ze=1}catch{}var Je=function(e){for(var t="",n=0;;){var r=e[n++],a=(r>127)+(r>223)+(r>239);if(n+a>e.length)return[t,ee(e,n-1)];a?a==3?(r=((r&15)<<18|(e[n++]&63)<<12|(e[n++]&63)<<6|e[n++]&63)-65536,t+=String.fromCharCode(55296|r>>10,56320|r&1023)):a&1?t+=String.fromCharCode((r&31)<<6|e[n++]&63):t+=String.fromCharCode((r&15)<<12|(e[n++]&63)<<6|e[n++]&63):t+=String.fromCharCode(r)}};function Qe(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}else{if($)return $.decode(e);var a=Je(e),u=a[0],d=a[1];if(d.length)throw"invalid utf-8 data";return u}}var Xe=function(e,t){return t+30+L(e,t+26)+L(e,t+28)},Ye=function(e,t,n){var r=L(e,t+28),a=Qe(e.subarray(t+46,t+46+r),!(L(e,t+8)&2048)),u=t+46+r,d=S(e,t+20),h=n&&d==4294967295?$e(e,u):[d,S(e,t+24),S(e,t+42)],o=h[0],c=h[1],w=h[2];return[L(e,t+10),o,c,a,u+L(e,t+30)+L(e,t+32),w]},$e=function(e,t){for(;L(e,t)!=1;t+=4+L(e,t+2));return[Q(e,t+12),Q(e,t+4),Q(e,t+20)]};function et(e){for(var t={},n=e.length-22;S(e,n)!=101010256;--n)if(!n||e.length-n>65558)throw"invalid zip file";var r=L(e,n+8);if(!r)return{};var a=S(e,n+16),u=a==4294967295;if(u){if(n=S(e,n-12),S(e,n)!=101075792)throw"invalid zip file";r=S(e,n+32),a=S(e,n+48)}for(var d=0;d<r;++d){var h=Ye(e,a,u),o=h[0],c=h[1],w=h[2],C=h[3],N=h[4],M=h[5],F=Xe(e,M);if(a=N,!o)t[C]=ee(e,F,F+c);else if(o==8)t[C]=Ke(e.subarray(F,F+c),new b(w));else throw"unknown compression type "+o}return t}class tt extends Ce{constructor(t){super(t)}load(t,n,r,a){const u=this,d=new xe(u.manager);d.setPath(u.path),d.setResponseType("arraybuffer"),d.setRequestHeader(u.requestHeader),d.setWithCredentials(u.withCredentials),d.load(t,function(h){try{n(u.parse(h))}catch(o){a?a(o):console.error(o),u.manager.itemError(t)}},r,a)}parse(t){function n(m){let l=new DataView(m);if(String.fromCharCode(l.getUint8(0),l.getUint8(1))==="PK"){let v=null,g=null;console.log("THREE.AMFLoader: Loading Zip");try{v=et(new Uint8Array(m))}catch(E){if(E instanceof ReferenceError)return console.log("THREE.AMFLoader: fflate missing and file is compressed."),null}for(g in v)if(g.toLowerCase().slice(-4)===".amf")break;console.log("THREE.AMFLoader: Trying to load file asset: "+g),l=new DataView(v[g].buffer)}const s=Ne.decodeText(l),i=new DOMParser().parseFromString(s,"application/xml");return i.documentElement.nodeName.toLowerCase()!=="amf"?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):i}function r(m){let l=1,f="millimeter";m.documentElement.attributes.unit!==void 0&&(f=m.documentElement.attributes.unit.value.toLowerCase());const s={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return s[f]!==void 0&&(l=s[f]),console.log("THREE.AMFLoader: Unit scale: "+l),l}function a(m){let l="AMF Material";const f=m.attributes.id.textContent;let s={r:1,g:1,b:1,a:1},i=null;for(let v=0;v<m.childNodes.length;v++){const g=m.childNodes[v];g.nodeName==="metadata"&&g.attributes.type!==void 0?g.attributes.type.value==="name"&&(l=g.textContent):g.nodeName==="color"&&(s=u(g))}return i=new le({flatShading:!0,color:new fe(s.r,s.g,s.b),name:l}),s.a!==1&&(i.transparent=!0,i.opacity=s.a),{id:f,material:i}}function u(m){const l={r:1,g:1,b:1,a:1};for(let f=0;f<m.childNodes.length;f++){const s=m.childNodes[f];s.nodeName==="r"?l.r=s.textContent:s.nodeName==="g"?l.g=s.textContent:s.nodeName==="b"?l.b=s.textContent:s.nodeName==="a"&&(l.a=s.textContent)}return l}function d(m){const l={name:"",triangles:[],materialid:null};let f=m.firstElementChild;for(m.attributes.materialid!==void 0&&(l.materialId=m.attributes.materialid.nodeValue);f;){if(f.nodeName==="metadata")f.attributes.type!==void 0&&f.attributes.type.value==="name"&&(l.name=f.textContent);else if(f.nodeName==="triangle"){const s=f.getElementsByTagName("v1")[0].textContent,i=f.getElementsByTagName("v2")[0].textContent,v=f.getElementsByTagName("v3")[0].textContent;l.triangles.push(s,i,v)}f=f.nextElementSibling}return l}function h(m){const l=[],f=[];let s=m.firstElementChild;for(;s;){if(s.nodeName==="vertex"){let i=s.firstElementChild;for(;i;){if(i.nodeName==="coordinates"){const v=i.getElementsByTagName("x")[0].textContent,g=i.getElementsByTagName("y")[0].textContent,E=i.getElementsByTagName("z")[0].textContent;l.push(v,g,E)}else if(i.nodeName==="normal"){const v=i.getElementsByTagName("nx")[0].textContent,g=i.getElementsByTagName("ny")[0].textContent,E=i.getElementsByTagName("nz")[0].textContent;f.push(v,g,E)}i=i.nextElementSibling}}s=s.nextElementSibling}return{vertices:l,normals:f}}function o(m){const l=m.attributes.id.textContent,f={name:"amfobject",meshes:[]};let s=null,i=m.firstElementChild;for(;i;){if(i.nodeName==="metadata")i.attributes.type!==void 0&&i.attributes.type.value==="name"&&(f.name=i.textContent);else if(i.nodeName==="color")s=u(i);else if(i.nodeName==="mesh"){let v=i.firstElementChild;const g={vertices:[],normals:[],volumes:[],color:s};for(;v;){if(v.nodeName==="vertices"){const E=h(v);g.normals=g.normals.concat(E.normals),g.vertices=g.vertices.concat(E.vertices)}else v.nodeName==="volume"&&g.volumes.push(d(v));v=v.nextElementSibling}f.meshes.push(g)}i=i.nextElementSibling}return{id:l,obj:f}}const c=n(t);let w="",C="";const N=r(c),M={},F={},_=c.documentElement.childNodes;let x,O;for(x=0;x<_.length;x++){const m=_[x];if(m.nodeName==="metadata")m.attributes.type!==void 0&&(m.attributes.type.value==="name"?w=m.textContent:m.attributes.type.value==="author"&&(C=m.textContent));else if(m.nodeName==="material"){const l=a(m);M[l.id]=l.material}else if(m.nodeName==="object"){const l=o(m);F[l.id]=l.obj}}const B=new ie,k=new le({color:11184895,flatShading:!0});B.name=w,B.userData.author=C,B.userData.loader="AMF";for(const m in F){const l=F[m],f=l.meshes,s=new ie;for(s.name=l.name||"",x=0;x<f.length;x++){let i=k;const v=f[x],g=new se(v.vertices,3);let E=null;if(v.normals.length&&(E=new se(v.normals,3)),v.color){const y=v.color;i=k.clone(),i.color=new fe(y.r,y.g,y.b),y.a!==1&&(i.transparent=!0,i.opacity=y.a)}const I=v.volumes;for(O=0;O<I.length;O++){const y=I[O],T=new ye;let D=i;T.setIndex(y.triangles),T.setAttribute("position",g.clone()),E&&T.setAttribute("normal",E.clone()),M[y.materialId]!==void 0&&(D=M[y.materialId]),T.scale(N,N,N),s.add(new Ee(T,D.clone()))}}B.add(s)}return B}}const nt=e=>(_e("data-v-7fbca4ca"),e=e(),ke(),e),rt={class:"box"},at={class:"option-container"},ot={class:"flex-between"},it=nt(()=>G("span",null,"渲染器背景色:",-1)),lt={__name:"amf",setup(e){let t,n,r,a,u;const d=()=>{t=new be,t.add(new Fe(10066329)),a=document.querySelector(".box"),n=new Me(35,a.clientWidth/a.clientHeight,1,500),n.up.set(0,0,1),n.position.set(0,-9,6),n.add(new Ae(16777215,.8)),t.add(n),r=new Se({antialias:!0}),r.setSize(a.clientWidth,a.clientHeight);const c=new Te(50,50,16777215,5592405);c.rotateOnAxis(new Le(1,0,0),90*(Math.PI/180)),t.add(c),r.setClearColor("#f2f2f2"),r.domElement&&a.appendChild(r.domElement),new tt().load("/models/amf/rook.amf",C=>{C.name="amfTest",t.add(C),o()});const w=()=>{o()};w(),o(),u=new Be(n,r.domElement),u.addEventListener("change",w),a.appendChild(r.domElement)},h=c=>{r.setClearColor(c.target.value),o()},o=()=>{r.render(t,n)};return Ue(()=>{d(),o()}),(c,w)=>(je(),Re("div",rt,[G("div",at,[G("div",ot,[it,G("input",{onInput:w[0]||(w[0]=C=>h(C)),value:"#000000",type:"color"},null,32)])])]))}},ct=Oe(lt,[["__scopeId","data-v-7fbca4ca"]]);export{ct as default};
